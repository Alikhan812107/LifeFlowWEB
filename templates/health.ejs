<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Health</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="nav">
        <a href="/">Development</a>
        <a href="/notes">Notes</a>
        <a href="/health" class="active">Health</a>
        <a href="/profile">Profile</a>
    </div>
    
    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab(event, 'sleep')">üí§ Sleep</button>
            <button class="tab-btn" onclick="switchTab(event, 'nutrition')">üçé Nutrition</button>
            <button class="tab-btn" onclick="switchTab(event, 'activity')">üèÉ Activity</button>
        </div>
        
        <div id="sleep-tab" class="tab-content active">
            <div class="health-grid">
                <div class="form-card">
                    <h2>Log Sleep</h2>
                    <form method="POST" action="/health/sleep">
                        <div class="form-group">
                            <label for="slept">When did you sleep?</label>
                            <input type="datetime-local" name="slept" id="slept" class="form-control" required>
                        </div>
                        <div class="form-group">
                            <label for="woke_up">When did you wake up?</label>
                            <input type="datetime-local" name="woke_up" id="woke_up" class="form-control" required>
                        </div>
                        <button type="submit" class="btn-submit">Add Sleep Record</button>
                    </form>
                </div>
                
                <div class="data-card">
                    <% if (sleeps && sleeps.length > 0) { %>
                        <div class="chart-container">
                            <h3>Sleep Duration (Hours)</h3>
                            <canvas id="sleepChart"></canvas>
                        </div>
                        
                        <div class="records-list">
                            <h3>Recent Records</h3>
                            <% sleeps.forEach(sleep => { %>
                            <div class="record-item">
                                <strong>Slept:</strong> <%= new Date(sleep.slept).toLocaleString() %> | 
                                <strong>Woke Up:</strong> <%= new Date(sleep.woke_up).toLocaleString() %>
                            </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <h3>No sleep records yet</h3>
                            <p>Start tracking your sleep!</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        
        <div id="nutrition-tab" class="tab-content">
            <div class="health-grid">
                <div class="form-card">
                    <h2>Log Nutrition</h2>
                    <form method="POST" action="/health/nutrition">
                        <div class="form-group">
                            <label for="calories">Calories</label>
                            <input type="number" name="calories" id="calories" class="form-control" required min="0">
                        </div>
                        <div class="form-group">
                            <label for="water">Water (litres)</label>
                            <input type="number" step="0.1" name="water" id="water" class="form-control" required min="0">
                        </div>
                        <div class="form-group">
                            <label>Did you eat healthy today?</label>
                            <div class="radio-group">
                                <label>
                                    <input type="radio" name="healthy" value="yes" required> Yes
                                </label>
                                <label>
                                    <input type="radio" name="healthy" value="no" required> No
                                </label>
                            </div>
                        </div>
                        <button type="submit" class="btn-submit">Add Nutrition Record</button>
                    </form>
                </div>
                
                <div class="data-card">
                    <% if (nutritions && nutritions.length > 0) { %>
                        <div class="chart-container">
                            <h3>Calories & Water</h3>
                            <canvas id="nutritionChart"></canvas>
                        </div>
                        
                        <div class="records-list">
                            <h3>Recent Records</h3>
                            <% nutritions.forEach(nutrition => { %>
                            <div class="record-item">
                                <strong>Date:</strong> <%= new Date(nutrition.timestamp).toLocaleDateString() %> | 
                                <strong>Calories:</strong> <%= nutrition.calories %> | 
                                <strong>Water:</strong> <%= nutrition.water %>L | 
                                <strong>Healthy:</strong> <%= nutrition.healthy ? 'Yes' : 'No' %>
                            </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <h3>No nutrition records yet</h3>
                            <p>Start tracking your nutrition!</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
        
        <div id="activity-tab" class="tab-content">
            <div class="health-grid">
                <div class="form-card">
                    <h2>Log Activity</h2>
                    <form method="POST" action="/health/activity">
                        <div class="form-group">
                            <label for="description">What activities did you do?</label>
                            <textarea name="description" id="description" class="form-control" placeholder="Describe your activities..." required></textarea>
                        </div>
                        <button type="submit" class="btn-submit">Add Activity</button>
                    </form>
                </div>
                
                <div class="data-card">
                    <% if (activities && activities.length > 0) { %>
                        <div class="records-list">
                            <h3>Your Activities (<%= activities.length %> total)</h3>
                            <% activities.forEach(activity => { %>
                            <div class="record-item">
                                <div style="font-size: 1.1rem; color: #495057; margin-bottom: 5px;"><%= activity.description %></div>
                                <div style="color: #6c757d; font-size: 0.9rem;"><%= new Date(activity.timestamp).toLocaleString() %></div>
                            </div>
                            <% }); %>
                        </div>
                    <% } else { %>
                        <div class="empty-state">
                            <h3>No activities yet</h3>
                            <p>Start tracking your activities!</p>
                        </div>
                    <% } %>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function switchTab(event, tab) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + '-tab').classList.add('active');
        }
        
        <% if (sleeps && sleeps.length > 0) { %>
        const sleepData = <%- JSON.stringify(sleeps) %>;
        const sleepLabels = sleepData.map(d => new Date(d.timestamp).toLocaleDateString());
        const sleepDurations = sleepData.map(d => {
            const diff = new Date(d.woke_up) - new Date(d.slept);
            return (diff / (1000 * 60 * 60)).toFixed(2);
        });
        
        const sleepCtx = document.getElementById('sleepChart').getContext('2d');
        new Chart(sleepCtx, {
            type: 'line',
            data: {
                labels: sleepLabels,
                datasets: [{
                    label: 'Sleep Duration (hours)',
                    data: sleepDurations,
                    borderColor: '#667eea',
                    backgroundColor: 'rgba(102, 126, 234, 0.1)',
                    tension: 0.4,
                    fill: true
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        beginAtZero: true
                    }
                }
            }
        });
        <% } %>
        
        <% if (nutritions && nutritions.length > 0) { %>
        const nutritionData = <%- JSON.stringify(nutritions) %>;
        const nutritionLabels = nutritionData.map(d => new Date(d.timestamp).toLocaleDateString());
        
        const nutritionCtx = document.getElementById('nutritionChart').getContext('2d');
        new Chart(nutritionCtx, {
            type: 'bar',
            data: {
                labels: nutritionLabels,
                datasets: [{
                    label: 'Calories',
                    data: nutritionData.map(d => d.calories),
                    backgroundColor: 'rgba(240, 147, 251, 0.6)',
                    borderColor: '#f093fb',
                    borderWidth: 2,
                    yAxisID: 'y'
                }, {
                    label: 'Water (L)',
                    data: nutritionData.map(d => d.water),
                    backgroundColor: 'rgba(79, 172, 254, 0.6)',
                    borderColor: '#4facfe',
                    borderWidth: 2,
                    yAxisID: 'y1'
                }]
            },
            options: {
                responsive: true,
                scales: {
                    y: {
                        type: 'linear',
                        position: 'left',
                        beginAtZero: true,
                        title: {
                            display: true,
                            text: 'Calories'
                        }
                    },
                    y1: {
                        type: 'linear',
                        position: 'right',
                        beginAtZero: true,
                        grid: {
                            drawOnChartArea: false
                        },
                        title: {
                            display: true,
                            text: 'Water (L)'
                        }
                    }
                }
            }
        });
        <% } %>
    </script>
</body>
</html>
